<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice - Ganeshay Transport</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    .invoice-container {
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      max-width: 900px;
      margin: 30px auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .invoice-header {
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: white;
      padding: 20px;
      border-radius: 12px 12px 0 0;
      text-align: center;
      margin-bottom: 30px;
    }

    .invoice-header h1 { margin-bottom: 5px; }
    .invoice-header p { margin: 0; font-size: 1.1rem; }

    .invoice-details {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 25px;
      font-size: 0.95rem;
    }

    .invoice-details .left, .invoice-details .right {
      width: 48%;
    }

    .invoice-details div { margin-bottom: 10px; }

    .table th {
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: white;
      text-align: center;
    }

    .table td {
      text-align: center;
      vertical-align: middle;
    }

    .table tbody tr:nth-child(even) {
      background-color: #f1f5f9;
    }

    .total-row {
      font-weight: bold;
      background-color: #4b6cb7;
      color: white;
    }

    .btn-container {
      text-align: center;
      margin: 20px 0;
    }

    @media (max-width: 576px) {
      .invoice-details .left, .invoice-details .right {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="invoice-container" id="invoiceContent">

  <!-- HEADER -->
  <div class="invoice-header">
    <h1>Ganeshay Transport</h1>
    <p>Invoice</p>
  </div>

  <!-- INVOICE DETAILS -->
  <div class="invoice-details">
    <div class="left">
      <strong>Client:</strong> <%= invoice.clientName %><br>
      <strong>Address:</strong> <%= invoice.clientAddress || 'N/A' %><br>
      <strong>Phone:</strong> <%= invoice.clientPhone || 'N/A' %>
    </div>
    <div class="right text-md-end">
      <strong>Invoice ID:</strong> <%= invoice._id %><br>
      <strong>Date:</strong> <%= new Date(invoice.invoiceDate).toLocaleDateString() %><br>
      <strong>Driver:</strong> <%= invoice.driverName %><br>
      <strong>Agent:</strong> <%= invoice.agentName %>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Bill No</th>
          <th>Vehicle No</th>
          <th>Delivery Date</th>
          <th>Delivery Time</th>
          <th>Tones</th>
          <th>Price/Tone</th>
          <th>Total</th>
          
        </tr>
      </thead>
      <tbody>
        <% invoice.items.forEach((item, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= item.billNo || '-' %></td>
            <td><%= item.vehicleNo %></td>
            <td><%= item.deliveryDate ? new Date(item.deliveryDate).toLocaleDateString() : '-' %></td>
            <td><%= item.deliveryTime || '-' %></td>
            <td><%= item.tones %></td>
            <td>₹<%= item.pricePerTone %></td>
            <td>₹<%= item.totalPrice %></td>
          </tr>
        <% }) %>
        <tr class="total-row">
          <td colspan="5" class="text-end">Grand Total</td>
          <td colspan="3">₹<%= invoice.totalAmount %></td>
        </tr>
      </tbody>
    </table>
  </div>

</div>


<!-- BUTTONS -->
<div class="btn-container">
  <a href="/invoices" class="btn btn-secondary">Back to Invoices</a>
  <button class="btn btn-success" onclick="printInvoice()">Print</button>
  <button class="btn btn-primary" onclick="downloadInvoice()">Download HTML</button>
</div>


<script>
function printInvoice() {
  const content = document.getElementById('invoiceContent').outerHTML;
  const printWindow = window.open('', '', 'width=900,height=700');
  printWindow.document.write('<html><head><title>Print Invoice</title>');
  printWindow.document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">');
  printWindow.document.write('<style>body{font-family: Arial,sans-serif;}</style>');
  printWindow.document.write('</head><body>');
  printWindow.document.write(content);
  printWindow.document.write('</body></html>');
  printWindow.document.close();
  printWindow.print();
}

function downloadInvoice() {
  const container = document.getElementById('invoiceContent').outerHTML;
  const fullHTML = `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Invoice - Ganeshay Transport</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body{font-family: Arial,sans-serif;background:#f8f9fa;color:#333;}
      .invoice-container{background:#fff;padding:30px;border-radius:12px;max-width:900px;margin:30px auto;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
      .invoice-header{background:linear-gradient(135deg, #4b6cb7, #182848);color:white;padding:20px;border-radius:12px 12px 0 0;text-align:center;margin-bottom:30px;}
      .invoice-details{display:flex;justify-content:space-between;flex-wrap:wrap;margin-bottom:25px;font-size:0.95rem;}
      .invoice-details .left, .invoice-details .right{width:48%;}
      .table th{background:linear-gradient(135deg, #4b6cb7, #182848);color:white;text-align:center;}
      .table td{text-align:center;vertical-align:middle;}
      .table tbody tr:nth-child(even){background-color:#f1f5f9;}
      .total-row{font-weight:bold;background-color:#4b6cb7;color:white;}
    </style>
  </head>
  <body>${container}</body>
  </html>
  `;
  
  const blob = new Blob([fullHTML], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `invoice_<%= invoice._id %>.html`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
